var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("desktop_speed",{type:"number",default:.04}),PlayerMovement.attributes.add("mobile_speed",{type:"number",default:.05}),PlayerMovement.attributes.add("threshold_value",{type:"number",default:.3,description:"Min distance between start joystick position and current to move player"}),PlayerMovement.prototype.initialize=function(){const e=window.matchMedia("only screen and (max-width: 768px)").matches;this.speed=e?this.mobile_speed:this.desktop_speed,this.camera=this.entity.findByName("Camera"),this.cameraScript=this.camera.script.cameraMovement,this.player=null,this.joystickForwardValue=0,this.joystickStrafeValue=0,this.app.on("player:move:forward",this.movePlayerForward,this),this.app.on("player:move:strafe",this.movePlayerStrafe,this)},PlayerMovement.worldDirection=new pc.Vec3,PlayerMovement.tempDirection=new pc.Vec3,PlayerMovement.prototype.update=function(e){if(null===this.player)return this.setActivePlayer();var t=PlayerMovement.worldDirection;t.set(0,0,0);var r=PlayerMovement.tempDirection,a=this.player.forward,i=this.player.right,s=0,o=0;(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(s-=1),(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(s+=1),(this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP))&&(o+=1),(this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN))&&(o-=1),0===s&&0===o&&(s=this.joystickStrafeValue,o=this.joystickForwardValue);const fixedValue=e=>Math.abs(e)!==e?e>-1*this.threshold_value?0:e:e<this.threshold_value?0:e;if(s=fixedValue(s),o=fixedValue(o),0!==s||0!==o){t.add(r.copy(a).mulScalar(-o)),t.add(r.copy(i).mulScalar(-s)),t.normalize();var p=new pc.Vec3(t.x*e,0,t.z*e);p.normalize().scale(this.speed),p.add(this.player.getPosition());var l=this.cameraScript.eulers.x,n=new pc.Vec3(0,l,0);this.player.rigidbody.teleport(p,n),this.app.fire("player:move")}this.player.anim.setFloat("xDirection",s),this.player.anim.setFloat("zDirection",o)},PlayerMovement.prototype.setActivePlayer=function(){const e=this.app.root.findByTag("player");if(0===e.length)throw new Error("Missing entities with player tag");const t=e.filter((e=>e.enabled));if(0===t.length)throw new Error("Noone player is enabled");if(t.length>1)throw new Error("Enabled more than 1 player");this.player=t[0]},PlayerMovement.prototype.movePlayerForward=function(e){this.joystickForwardValue=e},PlayerMovement.prototype.movePlayerStrafe=function(e){this.joystickStrafeValue=e};var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.attributes.add("touchSpeed",{type:"number",default:3,description:"Touch Sensitivity"}),CameraMovement.attributes.add("max_top",{type:"number",default:0,min:0,max:80,title:"Max top angle",description:"More value - lower angle"}),CameraMovement.attributes.add("max_bot",{type:"number",default:0,min:0,max:80,title:"Max bottom angle",description:"More value - upper angle"}),CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2;var e=this.app;this.rayEnd=this.getRaycastEndPoint(),e.mouse.on("mousemove",this.onMouseMove,this),e.mouse.on("mousedown",this.onMouseDown,this),e.on("player:look",this.onTouchMove,this),e.on("gender:change:callback",this.updateConfig,this),this.on("destroy",(function(){e.mouse.off("mousemove",this.onMouseMove,this),e.mouse.off("mousedown",this.onMouseDown,this),e.off("player:look",this.onTouchMove,this),e.off("gender:change:callback",this.updateConfig,this)}),this)},CameraMovement.prototype.postUpdate=function(e){var t=this.entity.parent,o=this.eulers.x,n=this.eulers.y,i=new pc.Vec3(-n,o,0);t.setEulerAngles(i),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(t.getPosition())},CameraMovement.prototype.onMouseMove=function(e){pc.Mouse.isPointerLocked()&&(this.moveLeftRight(e.dx,!0),this.moveUpDown(e.dy,!0))},CameraMovement.prototype.onTouchMove=function(e,t){this.moveLeftRight(e),this.moveUpDown(t)},CameraMovement.prototype.onMouseDown=function(e){const t=document.querySelector(".ui-wrapper"),o=document.querySelector(".animationController-ui");return(!t||e.element!=t&&!t.contains(e.element))&&((!o||e.element!=o&&!o.contains(e.element))&&void this.app.mouse.enablePointerLock())},CameraMovement.prototype.getWorldPoint=function(){var e=this.entity.parent.getPosition(),t=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(e,t);return o?o.point:t},CameraMovement.prototype.moveLeftRight=function(e,t=!1){const o=t?this.mouseSpeed:this.touchSpeed;this.eulers.x-=10*o*e/60%360,this.eulers.x<0&&(this.eulers.x+=360)},CameraMovement.prototype.moveUpDown=function(e,t=!1){const o=t?this.mouseSpeed:this.touchSpeed;this.eulers.y<0&&(this.eulers.y+=360);const n=10*o*(-1*e)/60%360,i=this.eulers.y+n,s=300+this.max_top,a=400-this.max_bot;if(i>0&&(i<s||i>a))return!1;this.eulers.y=i},CameraMovement.prototype.getRaycastEndPoint=function(){const e=this.app.root.findByTag("raycast_end").filter((e=>e.enabled));if(e.length>1)throw new Error('Enabled more than 1 raycast endpoint finded by "raycast_end" tag');return e[0]},CameraMovement.prototype.updateConfig=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2,this.rayEnd=this.getRaycastEndPoint()};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,e){function g(t,e,n,o){return h[0|t][Math.round(Math.min((e-n)/(o-n)*M,M))]}function r(){F.legend.fps!==q&&(F.legend.fps=q,F.legend[c]=q?"FPS":"ms"),b=q?v.fps:v.duration,F.count[c]=999<b?"999+":b.toFixed(99<b?0:O.decimals)}function m(){for(l=n(),P<l-O.threshold&&(v.fps-=v.fps/Math.max(1,60*O.smoothing/O.interval),v.duration=1e3/v.fps),w=O.history;w--;)T[w]=0===w?v.fps:T[w-1],j[w]=0===w?v.duration:j[w-1];if(r(),O.heat){if(z.length)for(w=z.length;w--;)z[w].el.style[o[z[w].name].heatOn]=q?g(o[z[w].name].heatmap,v.fps,0,O.maxFps):g(o[z[w].name].heatmap,v.duration,O.threshold,0);if(F.graph&&o.column.heatOn)for(w=C.length;w--;)C[w].style[o.column.heatOn]=q?g(o.column.heatmap,T[w],0,O.maxFps):g(o.column.heatmap,j[w],O.threshold,0)}if(F.graph)for(y=0;y<O.history;y++)C[y].style.height=(q?T[y]?Math.round(x/O.maxFps*Math.min(T[y],O.maxFps)):0:j[y]?Math.round(x/O.threshold*Math.min(j[y],O.threshold)):0)+"px"}function k(){20>O.interval?(p=i(k),m()):(p=setTimeout(k,O.interval),f=i(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),v.toggle()}function U(){O.toggleOn&&S(F.container,O.toggleOn,G,1),t.removeChild(F.container)}function V(){if(F.container&&U(),o=D.theme[O.theme],!(h=o.compiledHeatmaps||[]).length&&o.heatmaps.length){for(y=0;y<o.heatmaps.length;y++)for(h[y]=[],w=0;w<=M;w++){var e,n=h[y],a=w;e=.33/M*w;var i=o.heatmaps[y].saturation,l=o.heatmaps[y].lightness,p=void 0,c=void 0,u=void 0,d=u=void 0,f=p=c=void 0;f=void 0;0===(u=.5>=l?l*(1+i):l+i-l*i)?e="#000":(c=(u-(d=2*l-u))/u,f=(e*=6)-(p=Math.floor(e)),f*=u*c,0===p||6===p?(p=u,c=d+f,u=d):1===p?(p=u-f,c=u,u=d):2===p?(p=d,c=u,u=d+f):3===p?(p=d,c=u-f):4===p?(p=d+f,c=d):(p=u,c=d,u-=f),e="#"+N(p)+N(c)+N(u)),n[a]=e}o.compiledHeatmaps=h}for(var b in F.container=s(document.createElement("div"),o.container),F.count=F.container.appendChild(s(document.createElement("div"),o.count)),F.legend=F.container.appendChild(s(document.createElement("div"),o.legend)),F.graph=O.graph?F.container.appendChild(s(document.createElement("div"),o.graph)):0,z.length=0,F)F[b]&&o[b].heatOn&&z.push({name:b,el:F[b]});if(C.length=0,F.graph)for(F.graph.style.width=O.history*o.column.width+(O.history-1)*o.column.spacing+"px",w=0;w<O.history;w++)C[w]=F.graph.appendChild(s(document.createElement("div"),o.column)),C[w].style.position="absolute",C[w].style.bottom=0,C[w].style.right=w*o.column.width+w*o.column.spacing+"px",C[w].style.width=o.column.width+"px",C[w].style.height="0px";s(F.container,O),r(),t.appendChild(F.container),F.graph&&(x=F.graph.clientHeight),O.toggleOn&&("click"===O.toggleOn&&(F.container.style.cursor="pointer"),S(F.container,O.toggleOn,G))}"object"===H(t)&&undefined===t.nodeType&&(e=t,t=document.body),t||(t=document.body);var o,h,l,p,f,x,b,w,y,v=this,O=I({},D.defaults,e||{}),F={},C=[],M=100,z=[],E=O.threshold,A=0,P=n()-E,T=[],j=[],q="fps"===O.show;v.options=O,v.fps=0,v.duration=0,v.isPaused=0,v.tickStart=function(){A=n()},v.tick=function(){l=n(),E+=(l-P-E)/O.smoothing,v.fps=1e3/E,v.duration=A<P?E:l-A,P=l},v.pause=function(){return p&&(v.isPaused=1,clearTimeout(p),a(p),a(f),p=f=0),v},v.resume=function(){return p||(v.isPaused=0,k()),v},v.set=function(t,e){return O[t]=e,q="fps"===O.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(F.container,O),v},v.showDuration=function(){return v.set("show","ms"),v},v.showFps=function(){return v.set("show","fps"),v},v.toggle=function(){return v.set("show",q?"ms":"fps"),v},v.hide=function(){return v.pause(),F.container.style.display="none",v},v.show=function(){return v.resume(),F.container.style.display="block",v},v.destroy=function(){v.pause(),U(),v.tick=v.tickStart=function(){}},V(),k()}var n,o=t.performance;n=o&&(o.now||o.webkitNow)?o[o.now?"now":"webkitNow"].bind(o):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,i=t.requestAnimationFrame,h=0,l=0,p=(o=["moz","webkit","o"]).length;l<p&&!a;++l)i=(a=t[o[l]+"CancelAnimationFrame"]||t[o[l]+"CancelRequestAnimationFrame"])&&t[o[l]+"RequestAnimationFrame"];a||(i=function(e){var o=n(),a=Math.max(0,16-(o-h));return h=o+a,t.setTimeout((function(){e(o+a)}),a)},a=function(t){clearTimeout(t)});var c="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.fps=new FPSMeter({heat:!0,graph:!0})},Fps.prototype.update=function(t){this.fps.tick()};var VirtualJoystick=pc.createScript("virtualJoystick");VirtualJoystick.attributes.add("stick",{type:"entity"}),VirtualJoystick.attributes.add("enableEvent",{type:"string"}),VirtualJoystick.attributes.add("moveEvent",{type:"string"}),VirtualJoystick.attributes.add("disableEvent",{type:"string"}),VirtualJoystick.prototype.initialize=function(){var t=this.app;t.on(this.enableEvent,(function(t,i){this.entity.setLocalPosition(t,-i,0),this.stick.setLocalPosition(t,-i,0),this.entity.element.enabled=!0,this.stick.element.enabled=!0}),this),t.on(this.moveEvent,(function(t,i){this.stick.setLocalPosition(t,-i,0)}),this),t.on(this.disableEvent,(function(){this.entity.element.enabled=!1,this.stick.element.enabled=!1}),this)};var GamePadInput=pc.createScript("gamePadInput");GamePadInput.attributes.add("deadZoneLow",{title:"Low Dead Zone",description:"Radial thickness of inner dead zone of pad's joysticks. This dead zone ensures that all pads report a value of 0 for each joystick axis when untouched.",type:"number",min:0,max:.4,default:.1}),GamePadInput.attributes.add("deadZoneHigh",{title:"High Dead Zone",description:"Radial thickness of outer dead zone of pad's joysticks. This dead zone ensures that all pads can reach the -1 and 1 limits of each joystick axis.",type:"number",min:0,max:.4,default:.1}),GamePadInput.attributes.add("turnSpeed",{title:"Turn Speed",description:"Maximum turn speed in degrees per second",type:"number",default:90}),GamePadInput.prototype.initialize=function(){this.app;this.lastStrafe=0,this.lastForward=0,this.lastJump=!1,this.remappedPos=new pc.Vec2,this.leftStick={center:new pc.Vec2,pos:new pc.Vec2},this.rightStick={center:new pc.Vec2,pos:new pc.Vec2};var addEventListeners=function(){window.addEventListener("gamepadconnected",(function(e){})),window.addEventListener("gamepaddisconnected",(function(e){}))};this.on("enable",addEventListeners),this.on("disable",(function(){window.removeEventListener("gamepadconnected",(function(e){})),window.removeEventListener("gamepaddisconnected",(function(e){}))})),addEventListeners()},GamePadInput.prototype.update=function(e){for(var t=this.app,a=navigator.getGamepads?navigator.getGamepads():[],s=0;s<a.length;s++){var i=a[s];if(i&&"standard"===i.mapping&&i.axes.length>=4){this.leftStick.pos.set(i.axes[0],i.axes[1]),applyRadialDeadZone(this.leftStick.pos,this.remappedPos,this.deadZoneLow,this.deadZoneHigh);var n=this.remappedPos.x;this.lastStrafe!==n&&(t.fire("firstperson:strafe",n),this.lastStrafe=n);var d=-this.remappedPos.y;this.lastForward!==d&&(t.fire("firstperson:forward",d),this.lastForward=d),this.rightStick.pos.set(i.axes[2],i.axes[3]),applyRadialDeadZone(this.rightStick.pos,this.remappedPos,this.deadZoneLow,this.deadZoneHigh);var o=-this.remappedPos.x*this.turnSpeed*e,r=-this.remappedPos.y*this.turnSpeed*e;t.fire("firstperson:look",o,r),i.buttons[0].pressed&&!this.lastJump&&t.fire("firstperson:jump"),this.lastJump=i.buttons[0].pressed}}};var FirstPersonView=pc.createScript("firstPersonView");FirstPersonView.attributes.add("camera",{title:"Camera",description:"The camera controlled by this first person view. It should be a child of the entity to which this script is assigned. If no camera is assigned, the script will create one for you.",type:"entity"}),FirstPersonView.prototype.initialize=function(){var t=this.app;this.camera||(this.camera=this.entity.findByName("Camera"),this.camera||(this.camera=new pc.Entity("FPS Camera"),this.camera.addComponent("camera"))),this.x=new pc.Vec3,this.z=new pc.Vec3,this.heading=new pc.Vec3,this.magnitude=new pc.Vec2,this.azimuth=0,this.elevation=0;var i=this.camera.forward.clone();i.y=0,i.normalize(),this.azimuth=Math.atan2(-i.x,-i.z)*(180/Math.PI),(new pc.Mat4).setFromAxisAngle(pc.Vec3.UP,-this.azimuth).transformVector(this.camera.forward,i),this.elevation=Math.atan(i.y,i.z)*(180/Math.PI),this.forward=0,this.strafe=0,this.jump=!1,this.cnt=0,t.on("firstperson:forward",(function(t){this.forward=t}),this),t.on("firstperson:strafe",(function(t){this.strafe=t}),this),t.on("firstperson:look",(function(t,i){this.azimuth+=t,this.elevation+=i,this.elevation=pc.math.clamp(this.elevation,-90,90)}),this),t.on("firstperson:jump",(function(){this.jump=!0}),this)},FirstPersonView.prototype.update=function(t){const i=this.strafe<0?-1*Math.ceil(Math.abs(this.strafe)):Math.ceil(this.strafe),e=this.forward<0?-1*Math.ceil(Math.abs(this.forward)):Math.ceil(this.forward);this.entity.anim.setFloat("xDirection",i),this.entity.anim.setFloat("zDirection",e)},FirstPersonView.prototype.postUpdate=function(t){this.camera.setEulerAngles(this.elevation,this.azimuth,0),this.z.copy(this.camera.forward),this.z.y=0,this.z.normalize(),this.x.copy(this.camera.right),this.x.y=0,this.x.normalize(),this.heading.set(0,0,0),0!==this.forward&&(this.z.scale(this.forward),this.heading.add(this.z)),0!==this.strafe&&(this.x.scale(this.strafe),this.heading.add(this.x)),this.heading.length()>1e-4&&(this.magnitude.set(this.forward,this.strafe),this.heading.normalize().scale(this.magnitude.length())),this.jump&&(this.entity.script.characterController.jump(),this.jump=!1),this.entity.script.characterController.move(this.heading);var i=this.camera.getPosition();this.app.fire("cameramove",i)};var CharacterController=pc.createScript("characterController");CharacterController.attributes.add("speed",{type:"number",default:5}),CharacterController.attributes.add("jumpImpulse",{type:"number",default:400}),CharacterController.prototype.initialize=function(){this.groundCheckRay=new pc.Vec3(0,-1.2,0),this.rayEnd=new pc.Vec3,this.groundNormal=new pc.Vec3,this.onGround=!0,this.jumping=!1},CharacterController.prototype.move=function(t){if(this.onGround&&!this.jumping){var r=new pc.Vec3,e=t.length();e>0&&(r.cross(this.groundNormal,t).cross(r,this.groundNormal),r.normalize().scale(e*this.speed)),this.entity.rigidbody.linearVelocity=r}},CharacterController.prototype.jump=function(){this.onGround&&!this.jumping&&(this.entity.rigidbody.applyImpulse(0,this.jumpImpulse,0),this.onGround=!1,this.jumping=!0,setTimeout(function(){this.jumping=!1}.bind(this),500))},CharacterController.prototype.update=function(t){var r=this.entity.getPosition();this.rayEnd.add2(r,this.groundCheckRay);var e=this.app.systems.rigidbody.raycastFirst(r,this.rayEnd);this.onGround=!!e,e&&this.groundNormal.copy(e.normal)};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var i=this.entity.getRotation();if(this._yaw=this._calcYaw(i),this._pitch=this._clampPitchAngle(this._calcPitch(i,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var e=new pc.Vec3;e.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(e.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)}))},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e,a=0,n=0;if(t instanceof pc.Entity){var s=[],r=t.findComponents("render");for(a=0;a<r.length;++a)for(e=r[a].meshInstances,n=0;n<e.length;n++)s.push(e[n]);var h=t.findComponents("model");for(a=0;a<h.length;++a)for(e=h[a].meshInstances,n=0;n<e.length;n++)s.push(e[n]);for(a=0;a<s.length;a++)0===i?this._modelsAabb.copy(s[a].aabb):this._modelsAabb.add(s[a].aabb),i+=1}for(a=0;a<t.children.length;++a)i+=this._buildAabb(t.children[a],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var n=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,n),Math.atan2(n.y,-n.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var TouchInput=pc.createScript("touchInput");function applyRadialDeadZone(e,t,i,r){var s=e.length();if(s>i){var a=1-r-i,n=Math.min(1,(s-i)/a)/s;t.copy(e).scale(n)}else t.set(0,0)}TouchInput.attributes.add("deadZone",{title:"Dead Zone",description:"Radial thickness of inner dead zone of the virtual joysticks. This dead zone ensures the virtual joysticks report a value of 0 even if a touch deviates a small amount from the initial touch.",type:"number",min:0,max:.4,default:.3}),TouchInput.attributes.add("turnSpeed",{title:"Turn Speed",description:"Maximum turn speed in degrees per second",type:"number",default:150}),TouchInput.attributes.add("radius",{title:"Radius",description:"The radius of the virtual joystick in CSS pixels.",type:"number",default:50}),TouchInput.attributes.add("doubleTapInterval",{title:"Double Tap Interval",description:"The time in milliseconds between two taps of the right virtual joystick for a double tap to register. A double tap will trigger a jump.",type:"number",default:300}),TouchInput.prototype.initialize=function(){var e=this.app,t=e.graphicsDevice,i=t.canvas;this.remappedPos=new pc.Vec2,this.leftStick={identifier:-1,center:new pc.Vec2,pos:new pc.Vec2},this.rightStick={identifier:-1,center:new pc.Vec2,pos:new pc.Vec2},this.lastRightTap=0;var r=function(r){r.preventDefault();for(var s=t.width/i.clientWidth,a=t.height/i.clientHeight,n=r.changedTouches,h=0;h<n.length;h++){var o=n[h];if(o.pageX<=i.clientWidth/2&&-1===this.leftStick.identifier)this.leftStick.identifier=o.identifier,this.leftStick.center.set(o.pageX,o.pageY),this.leftStick.pos.set(0,0),e.fire("leftjoystick:enable",o.pageX*s,o.pageY*a);else if(o.pageX>i.clientWidth/2&&-1===this.rightStick.identifier){this.rightStick.identifier=o.identifier,this.rightStick.center.set(o.pageX,o.pageY),this.rightStick.pos.set(0,0),e.fire("rightjoystick:enable",o.pageX*s,o.pageY*a);var p=Date.now();p-this.lastRightTap<this.doubleTapInterval&&e.fire("firstperson:jump"),this.lastRightTap=p}}}.bind(this),s=function(r){r.preventDefault();for(var s=t.width/i.clientWidth,a=t.height/i.clientHeight,n=r.changedTouches,h=0;h<n.length;h++){var o=n[h];o.identifier===this.leftStick.identifier?(this.leftStick.pos.set(o.pageX,o.pageY),this.leftStick.pos.sub(this.leftStick.center),this.leftStick.pos.scale(1/this.radius),e.fire("leftjoystick:move",o.pageX*s,o.pageY*a)):o.identifier===this.rightStick.identifier&&(this.rightStick.pos.set(o.pageX,o.pageY),this.rightStick.pos.sub(this.rightStick.center),this.rightStick.pos.scale(1/this.radius),e.fire("rightjoystick:move",o.pageX*s,o.pageY*a))}}.bind(this),a=function(t){t.preventDefault();for(var i=t.changedTouches,r=0;r<i.length;r++){var s=i[r];s.identifier===this.leftStick.identifier?(this.leftStick.identifier=-1,e.fire("firstperson:forward",0),e.fire("firstperson:strafe",0),e.fire("player:move:strafe",0),e.fire("player:move:forward",0),e.fire("leftjoystick:disable")):s.identifier===this.rightStick.identifier&&(this.rightStick.identifier=-1,e.fire("rightjoystick:disable"))}}.bind(this),addEventListeners=function(){i.addEventListener("touchstart",r,!1),i.addEventListener("touchmove",s,!1),i.addEventListener("touchend",a,!1)};this.on("enable",addEventListeners),this.on("disable",(function(){i.removeEventListener("touchstart",r,!1),i.removeEventListener("touchmove",s,!1),i.removeEventListener("touchend",a,!1)})),addEventListeners()},TouchInput.prototype.update=function(e){var t=this.app;if(-1!==this.leftStick.identifier){applyRadialDeadZone(this.leftStick.pos,this.remappedPos,this.deadZone,0);var i=this.remappedPos.x;this.lastStrafe!==i&&(t.fire("firstperson:strafe",i),t.fire("player:move:strafe",i),this.lastStrafe=i);var r=-this.remappedPos.y;this.lastForward!==r&&(t.fire("firstperson:forward",r),t.fire("player:move:forward",r),this.lastForward=r)}if(-1!==this.rightStick.identifier){applyRadialDeadZone(this.rightStick.pos,this.remappedPos,this.deadZone,0);var s=-this.remappedPos.x*this.turnSpeed*e,a=-this.remappedPos.y*this.turnSpeed*e;t.fire("firstperson:look",s,a),t.fire("player:look",s,a)}};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInput.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInput.prototype.update=function(t){this.orbitCamera&&this.app.keyboard.wasPressed(pc.KEY_SPACE)&&(this.orbitCamera.reset(this.startYaw,this.startPitch,this.startDistance),this.orbitCamera.pivotPoint=this.startPivotPosition)};var CollisionTrigger=pc.createScript("collisionTrigger");CollisionTrigger.attributes.add("name",{type:"string"}),CollisionTrigger.attributes.add("event_param",{type:"string",default:"consultant"}),CollisionTrigger.attributes.add("gender",{type:"string",default:"man",title:"Gender",enum:[{man:"man"},{woman:"woman"},{all:"all"}]}),CollisionTrigger.prototype.initialize=function(){this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.entity.collision.on("collisionend",this.onCollisionEnd,this)},CollisionTrigger.prototype.onCollisionStart=function(i){if(pc.app.root.findByName("Root").script.appState.getGender()!==this.gender&&"all"!==this.gender)return!1;this.app.fire(`trigger:${this.name}:start`,{event:this.event_param,gender:this.gender})},CollisionTrigger.prototype.onCollisionEnd=function(i){if(pc.app.root.findByName("Root").script.appState.getGender()!==this.gender&&"all"!==this.gender)return!1;this.app.fire(`trigger:${this.name}:end`)};var WindowEventResolver=pc.createScript("windowEventResolver");WindowEventResolver.prototype.initialize=function(){var e=this;const genderChangeCallback=function(n){e.app.fire("gender:change",n.detail.sex)},sceneSwitchCallback=function(n){e.app.fire("switch:scene",n.detail.scene)};window.addEventListener("gender:change",genderChangeCallback),window.addEventListener("scene:switch",sceneSwitchCallback),this.app.on("responde_to_window",this.respondeToWindow,this),this.app.on("send_to_window",this.sendToWindow,this),this.on("destroy",(function(){this.app.off("responde_to_window",this.respondeToWindow,this),this.app.off("send_to_window",this.sendToWindow,this),console.log("remove events"),window.removeEventListener("gender:change",genderChangeCallback),window.removeEventListener("scene:switch",sceneSwitchCallback)}),this)},WindowEventResolver.prototype.respondeToWindow=function(e,n){const o=new CustomEvent(`${e}_response`,{detail:n});window.dispatchEvent(o)},WindowEventResolver.prototype.sendToWindow=function(e,n){const o=new CustomEvent(`${e}_canvas`,{detail:n});window.dispatchEvent(o)};var ApiGenderChange=pc.createScript("apiGenderChange");ApiGenderChange.attributes.add("event_name",{type:"string",default:"gender:change",title:"Event name"}),ApiGenderChange.prototype.initialize=function(){this.availableParams=["man","woman"],this.app.on(this.event_name,this.process,this),this.on("destroy",(function(){this.app.off(this.event_name,this.process,this)}),this)},ApiGenderChange.prototype.process=function(e){this.validateParam(e);this.app.root.findByTag("player").map((a=>{a.enabled=a.tags.has(`player:${e}`)})),this.app.mouse.enablePointerLock(),this.app.fire("gender:change:callback"),this.app.fire("responde_to_window",this.event_name,{processed:!0}),pc.app.root.findByName("Root").script.appState.setGender(e)},ApiGenderChange.prototype.validateParam=function(e){if(!this.availableParams.includes(e))throw this.app.fire("responde_to_window",this.event_name,{processed:!1}),new Error(`Wrong param | Command: gender:change | Given: ${e} | Available: ${this.availableParams.join(", ")}`)};var Ui=pc.createScript("ui");Ui.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Ui.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Ui.prototype.initialize=function(){var e=document.createElement("style");document.head.appendChild(e),e.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div)},Ui.prototype.postInitialize=function(){this.addEvents()},Ui.prototype.addEvents=function(){const e=this;document.querySelector("#man").addEventListener("click",(function(){e.dispatchEvent("gender:change",{sex:"man"})}));document.querySelector("#woman").addEventListener("click",(function(){e.dispatchEvent("gender:change",{sex:"woman"})})),window.addEventListener("gender:change_response",(function(e){document.querySelector(".ui-wrapper").classList.add("hidden")}))},Ui.prototype.dispatchEvent=function(e,t){const n=new CustomEvent(e,{detail:t});window.dispatchEvent(n)};var RotateX=pc.createScript("rotateX");RotateX.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),RotateX.attributes.add("tabletOrbitSensitivity",{type:"number",default:.3,title:"Tablet Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),RotateX.attributes.add("desktopOrbitSensitivity",{type:"number",default:.3,title:"Desktop Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),RotateX.prototype.initialize=function(){this.lastTouchPoint=new pc.Vec2,this.currentY=this.entity.getLocalRotation().getEulerAngles().y,this.on("attr:tabletOrbitSensitivity",(function(t){this.tabletOrbitSensitivity=t}),this),this.on("attr:desktopOrbitSensitivity",(function(t){this.desktopOrbitSensitivity=t}),this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.touch&&(this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)),this.off("attr:tabletOrbitSensitivity",(function(t){this.tabletOrbitSensitivity=t}),this),this.off("attr:desktopOrbitSensitivity",(function(t){this.desktopOrbitSensitivity=t}),this)}),this)},RotateX.horizontalQuat=new pc.Quat,RotateX.eventType={DESKTOP:"DESKTOP",TABLET:"TABLET"},RotateX.prototype.rotate=function(t,i){const e=i===RotateX.eventType.TABLET?this.tabletOrbitSensitivity:this.desktopOrbitSensitivity;this.currentY+=t*e,this.entity.setRotation(this.entity.getRotation().setFromEulerAngles(0,this.currentY,0))},RotateX.prototype.onTouchStart=function(t){var i=t.touches[0];this.lastTouchPoint.set(i.x)},RotateX.prototype.onTouchMove=function(t){var i=t.touches[0],e=i.x-this.lastTouchPoint.x;this.rotate(e,RotateX.eventType.TABLET),this.lastTouchPoint.set(i.x)},RotateX.prototype.onMouseMove=function(t){this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)&&this.rotate(t.dx,RotateX.eventType.DESKTOP)};var AnimationControllerUi=pc.createScript("animationControllerUi");AnimationControllerUi.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),AnimationControllerUi.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),AnimationControllerUi.prototype.initialize=function(){var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div)},AnimationControllerUi.prototype.postInitialize=function(){this.addEvents()},AnimationControllerUi.prototype.addEvents=function(){const t=this;document.querySelector("#sad").addEventListener("click",(function(){t.app.fire("animation-debug","sad")}));document.querySelector("#smile").addEventListener("click",(function(){t.app.fire("animation-debug","smile")}))},AnimationControllerUi.prototype.dispatchEvent=function(t,e){const i=new CustomEvent(t,{detail:e});window.dispatchEvent(i)};var AnimationDebuger=pc.createScript("animationDebuger");AnimationDebuger.attributes.add("sad",{type:"asset",assetType:"animation"}),AnimationDebuger.attributes.add("smile",{type:"asset",assetType:"animation"}),AnimationDebuger.prototype.initialize=function(){this.timeout=null,this.app.on("animation-debug",this.changeAnimation,this),this.on("destroy",(function(){this.app.off("animation-debug",this.changeAnimation,this)}),this)},AnimationDebuger.prototype.update=function(t){},AnimationDebuger.prototype.changeAnimation=function(t){null!==this.timeout&&clearTimeout(this.timeout);const i="sad"===t,e=i?-1:1,n=i?this.sad.resource.duration:this.smile.resource.duration;this.entity.anim.setInteger("Type",e);const a=this;this.timeout=setTimeout((function(){a.entity.anim.setInteger("Type",0)}),1e3*n)};var ApiTriggerConsultant=pc.createScript("apiTriggerConsultant");ApiTriggerConsultant.attributes.add("event_name_start",{type:"string",default:"consultant:start",title:"Start event name"}),ApiTriggerConsultant.attributes.add("event_name_end",{type:"string",default:"consultant:end",title:"End event name"}),ApiTriggerConsultant.prototype.initialize=function(){this.app.on(this.event_name_start,this.onStart,this),this.app.on(this.event_name_end,this.onEnd,this),this.on("destroy",(function(){this.app.off(this.event_name_start,this.onStart,this),this.app.off(this.event_name_end,this.onEnd,this)}),this)},ApiTriggerConsultant.prototype.onStart=function(){console.log("onStart consultant"),this.app.fire("send_to_window","consultant:dialog",{show:!0})},ApiTriggerConsultant.prototype.onEnd=function(){console.log("onEnd consultant"),this.app.fire("send_to_window","consultant:dialog",{show:!1})};var ApiLoadingEnd=pc.createScript("apiLoadingEnd");ApiLoadingEnd.prototype.initialize=function(){console.log("loading end"),this.app.fire("send_to_window","loading:end",{})};var ApiTriggerClothes=pc.createScript("apiTriggerClothes");ApiTriggerClothes.attributes.add("event_name_start",{type:"string",default:"api:clothes:start",title:"Start event name"}),ApiTriggerClothes.attributes.add("event_name_end",{type:"string",default:"api:clothes:end",title:"End event name"}),ApiTriggerClothes.prototype.initialize=function(){this.app.on(this.event_name_start,this.onStart,this),this.app.on(this.event_name_end,this.onEnd,this),this.on("destroy",(function(){this.app.off(this.event_name_start,this.onStart,this),this.app.off(this.event_name_end,this.onEnd,this)}),this)},ApiTriggerClothes.prototype.onStart=function(t){console.log("onStart clothes",t),this.app.fire("send_to_window","clothes:ui",t)},ApiTriggerClothes.prototype.onEnd=function(t){console.log("onEnd clothes",t),this.app.fire("send_to_window","clothes:ui",t)};var ActionButton=pc.createScript("actionButton");ActionButton.attributes.add("event_name_start",{type:"string",default:"trigger:actionButton:start",title:"Start event name"}),ActionButton.attributes.add("event_name_end",{type:"string",default:"trigger:actionButton:end",title:"End event name"}),ActionButton.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),ActionButton.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),ActionButton.prototype.initialize=function(){this.actionDispatched=!1,this.event="",this.gender="man";const t="actionButtonStyles";var e=document.createElement("style");e.id=t,document.head.appendChild(e),e.innerHTML=this.css.resource||"";const n="actionButtonContainer";this.div=document.createElement("div"),this.div.classList.add("container"),this.div.id=n,this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div),this.app.on(this.event_name_start,this.show,this),this.app.on(this.event_name_end,this.hide,this),this.app.on("player:move",this.onPlayerMove,this),this.on("destroy",(function(){this.app.off(this.event_name_start,this.show,this),this.app.off(this.event_name_end,this.hide,this),this.app.off("player:move",this.onPlayerMove,this);const e=document.getElementById(t),i=document.getElementById(n);e.parentNode.removeChild(e),i.parentNode.removeChild(i),this.removeEvents()}),this)},ActionButton.prototype.postInitialize=function(){this.addEvents()},ActionButton.prototype.show=function({event:t,gender:e}){if(this.actionDispatched)return!1;this.event=t,this.gender=e;document.querySelector(".actionButtonWrapper").classList.add("visible")},ActionButton.prototype.hide=function(){document.querySelector(".actionButtonWrapper").classList.remove("visible")},ActionButton.prototype.onPlayerMove=function(){this.actionDispatched&&(this.hide(),this.app.fire(`${this.event}:${this.gender}:end`),this.actionDispatched=!1)};const onKeyDown=(t,e)=>{if("KeyE"!==t.code)return!1;e.actionDispatched=!0,e.hide(),e.app.fire(`${e.event}:${e.gender}:start`),e.app.mouse.disablePointerLock()};ActionButton.prototype.addEvents=function(){document.addEventListener("keydown",(t=>onKeyDown(t,this)))},ActionButton.prototype.removeEvents=function(){document.removeEventListener("keydown",(t=>onKeyDown(t,this)))};function throttle(t,n){var i=!1;return function(){i||(t.apply(this,arguments),i=!0,setTimeout((function(){i=!1}),n))}}var ClothesTrigger=pc.createScript("clothesTrigger");ClothesTrigger.attributes.add("clothes_type",{type:"string",default:"tshirt",title:"Clothes type"}),ClothesTrigger.attributes.add("gender",{type:"string",default:"man",title:"Gender",enum:[{man:"man"},{woman:"woman"}]}),ClothesTrigger.prototype.initialize=function(){this.app.on(`${this.clothes_type}:${this.gender}:start`,this.onStart,this),this.app.on(`${this.clothes_type}:${this.gender}:end`,this.onEnd,this),this.on("destroy",(function(){this.app.off(`${this.clothes_type}:start`,this.onStart,this),this.app.off(`${this.clothes_type}:end`,this.onEnd,this)}),this)},ClothesTrigger.prototype.onStart=function(){console.log("onStart ClothesTrigger",this.clothes_type,this.gender),this.app.fire("api:clothes:start",{type:this.clothes_type,gender:this.gender,show:!0})},ClothesTrigger.prototype.onEnd=function(){console.log("onEnd ClothesTrigger"),this.app.fire("api:clothes:end",{type:this.clothes_type,gender:this.gender,show:!1})};var AppState=pc.createScript("appState");AppState.prototype.initialize=function(){this.state={gender:"man"}},AppState.prototype.setGender=function(t){this.state.gender=t},AppState.prototype.getGender=function(){return this.state.gender},AppState.prototype.getState=function(){return this.state};function loadScene(e,n,c,l){var a=pc.Application.getApplication(),o=a.scenes.find(e);if(console.log("loadScene",e,n),o){var s=o.loaded;a.scenes.loadSceneData(o,(function(e,o){if(e)c&&c.call(l,e);else{for(var t=null,i=a.root.children;i.length>0;)i[0].destroy();n.settings&&a.scenes.loadSceneSettings(o,(function(e){e&&c&&c.call(l,e)})),n.hierarchy&&a.scenes.loadSceneHierarchy(o,(function(e,n){e?c&&c(e):t=n})),s||a.scenes.unloadSceneData(o),c&&c.call(l,null,t)}}))}else c&&c.call(l,"Scene not found: "+e)}var ApiSwitchScene=pc.createScript("apiSwitchScene");const EVENT="scene:switch";ApiSwitchScene.attributes.add("event_name",{type:"string",default:EVENT,title:"Event name"}),ApiSwitchScene.prototype.initialize=function(){this.availableParams=["store","fitting"],this.app.on(this.event_name,this.process,this),this.on("destroy",(function(){this.app.off(this.event_name,this.process,this)}),this)},ApiSwitchScene.prototype.process=function(e){try{this.validateParam(e),console.log("switch scene",e),loadScene(e,{hierarchy:!0,settings:!0}),this.app.mouse.enablePointerLock(),this.app.fire(`${EVENT}:callback`),this.app.fire("responde_to_window",this.event_name,{processed:!0})}catch(e){console.error(e.message),this.app.fire("responde_to_window",this.event_name,{processed:!1})}},ApiSwitchScene.prototype.validateParam=function(e){if(!this.availableParams.includes(e))throw this.app.fire("responde_to_window",this.event_name,{processed:!1}),new Error(`Wrong param | Command: ${EVENT} | Given: ${e} | Available: ${this.availableParams.join(", ")}`)};